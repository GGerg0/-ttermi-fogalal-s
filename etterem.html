<!DOCTYPE html>
<html lang="hu">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Étterem</title>
  </head>
  <body>
    <h1>Étterem heti asztalfoglalása</h1>
    <table>
      <tr id="myrow">
        <th>Hétfő</th>
      </tr>
      <tr>
        <th>Kedd</th>
      </tr>
      <tr>
        <th>Szerda</th>
      </tr>
      <tr>
        <th>Csütörtök</th>
      </tr>
      <tr>
        <th>Péntek</th>
      </tr>
      <tr>
        <th>Szombat</th>
      </tr>
      <tr>
        <th>Vasárnap</th>
      </tr>
    </table>

    <h3>Időpontfoglalás</h3>
    <label for="nev">Név: </label
    ><input name="nev" type="text" id="nev" /><br />
    <label for="nap">Nap: </label
    ><select name="nap" id="nap">
      <option value="1">Hétfő</option>
      <option value="2">Kedd</option>
      <option value="3">Szerda</option>
      <option value="4">Csütörtök</option>
      <option value="5">Péntek</option>
      <option value="6">Szombat</option>
      <option value="7">Vasárnap</option></select
    ><br />
    <label for="ido">Időpont: </label
    ><input name="ido" type="time" id="ido" /><br />
    <label for="fo">Személyek száma: </label
    ><input
      name="fo"
      type="number"
      min="1"
      max="8"
      placeholder="2"
      id="fo"
    /><br />

    <button id="create">Asztal foglalása</button>

    <script>
      const nev = document.getElementById("nev");
      const nap = document.getElementById("nap");
      const ido = document.getElementById("ido");
      const fo = document.getElementById("fo");
      const create = document.getElementById("create");
      const napok = [
        document.querySelector("tr:first-child"),
        document.querySelector("tr:nth-child(2)"),
        document.querySelector("tr:nth-child(3)"),
        document.querySelector("tr:nth-child(4)"),
        document.querySelector("tr:nth-child(5)"),
        document.querySelector("tr:nth-child(6)"),
        document.querySelector("tr:last-child"),
      ];
      const dels = [];

      function OrderByTime() {
        let t = [];

        

        for (let i = 0; i < localStorage.length; i++) {
          t.push(JSON.parse(localStorage[localStorage.key(i)]));
        }
        t.sort((a, b) => a.nap - b.nap);
        return t;
      }

      function stringToPerc(s) {
        let tmp = s.split(":");
        return parseInt(tmp[0]) * 60 + parseInt(tmp[1]);
      }

      function kiIras(f) {
        switch (f.nap) {
          case 1:
            return `Név: ${f.nev} Nap: Hétfő-${f.oraPerc} Foglaltak száma: ${f.fo}`;
          case 2:
            return `Név: ${f.nev} Időpont: Kedd-${f.oraPerc} Foglaltak száma: ${f.fo}`;
          case 3:
            return `Név: ${f.nev} Időpont: Szerda-${f.oraPerc} Foglaltak száma: ${f.fo}`;
          case 4:
            return `Név: ${f.nev} Időpont: Csütörtök-${f.oraPerc} Foglaltak száma: ${f.fo}`;
          case 5:
            return `Név: ${f.nev} Időpont: Péntek-${f.oraPerc} Foglaltak száma: ${f.fo}`;
          case 6:
            return `Név: ${f.nev} Időpont: Szombat-${f.oraPerc} Foglaltak száma: ${f.fo}`;
          case 7:
            return `Név: ${f.nev} Időpont: Vasárnap-${f.oraPerc} Foglaltak száma: ${f.fo}`;
        }
      }

      if (localStorage.length == 0) {
        localStorage.setItem(
          0,
          JSON.stringify({
            nev: "Kovács András",
            nap: 1,
            oraPerc: "12:30",
            fo: 3,
          })
        );
        localStorage.setItem(
          1,
          JSON.stringify({
            nev: "Szabó Katalin",
            nap: 2,
            oraPerc: "11:45",
            fo: 6,
          })
        );
        localStorage.setItem(
          2,
          JSON.stringify({
            nev: "Nagy Eszter",
            nap: 6,
            oraPerc: "15:00",
            fo: 2,
          })
        );
        localStorage.setItem(
          3,
          JSON.stringify({
            nev: "Tóth Gergely",
            nap: 7,
            oraPerc: "18:15",
            fo: 4,
          })
        );
        localStorage.setItem(
          4,
          JSON.stringify({
            nev: "Farkas Péter",
            nap: 5,
            oraPerc: "17:45",
            fo: 4,
          })
        );
      }

      for (let i = 0; i < localStorage.length; i++) {}

      

      create.addEventListener("click", () => {
        let f = {
          nev: nev.value,
          nap: parseInt(nap.value),
          oraPerc: ido.value,
          fo: parseInt(fo.value),
        };
        counter = 0;
        while(localStorage.getItem(counter) != null)
        {
          counter++
        }
        localStorage.setItem(counter, JSON.stringify(f));
        Reload()
      });

      function Reload() {

        let counter = 0;
        let foglalasok = OrderByTime();
        for (let i = 1; i < 8; i++) {
          
          let napiFoglalas = foglalasok.filter((f) => f.nap == i);
          napiFoglalas.sort(
            (a, b) => stringToPerc(a.oraPerc) - stringToPerc(b.oraPerc)
          );
          for (let n = napok[i-1].cells.length; n > 1; n--)
        {
          napok[i-1].deleteCell(1)
          console.log(napok[i-1].cells.length)
        }
          for (let j = 0; j < napiFoglalas.length; j++) {
            const row = napok[napiFoglalas[j].nap - 1];
        const cell = row.insertCell(1);
        cell.innerHTML = `${kiIras(napiFoglalas[j])} <button class="delete" id="Btn${counter}">kuka</button>`;
        dels.push(document.getElementById(`Btn${counter}`))
        counter++
          }
        }
        dels.forEach(b => {
        b.addEventListener("click",()=> {
          console.log(b.id)
          const elem = document.querySelector(`td:has(#${b.id})`)  
          elem.remove()
          localStorage.removeItem(localStorage.key(dels.indexOf(b)))
        })
      })

      }
      Reload();

      
      
    </script>
  </body>
</html>
